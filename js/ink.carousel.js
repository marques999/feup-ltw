Ink.createModule("Ink.UI.Carousel","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Css_1","Ink.Dom.Element_1","Ink.UI.Pagination_1","Ink.Dom.Browser_1","Ink.Dom.Selector_1"],function(t,i,e,n,s,o){"use strict";function a(t,i,e){return Math.min(e,Math.max(i,t))}function h(){t.BaseUIComponent.apply(this,arguments)}function _(t,i){t.style.transitionProperty=t.style.oTransitionProperty=t.style.msTransitionProperty=t.style.mozTransitionProperty=t.style.webkitTransitionProperty=i}var l=window.requestAnimationFrame||function(t){return setTimeout(t,1e3/30)};return h._name="Carousel_1",h._optionDefinition={autoAdvance:["Integer",0],axis:["String","x"],initialPage:["Integer",0],spaceAfterLastSlide:["Boolean",!0],keyboardSupport:["Boolean",!1],pagination:["String",null],onChange:["Function",null],onInit:["Function",function(){}],swipe:["Boolean",!0]},h.prototype={_validate:function(){var t=Ink.s("ul.stage",this._element);return t?void 0:new Error("Carousel must contain a ul.stage element!")},_init:function(){this._handlers={paginationChange:Ink.bindMethod(this,"_onPaginationChange"),windowResize:i.throttle(Ink.bindMethod(this,"refit"),200)},i.observe(window,"resize",this._handlers.windowResize),this._isY="y"===this._options.axis;var t=Ink.s("ul.stage",this._element);t.style.width="100%",this._ulEl=t,n.removeTextNodeChildren(t),null==this._options.pagination&&(this._currentPage=this._options.initialPage),this.refit(),this._isY&&(this._ulEl.style.whiteSpace="normal"),this._options.swipe&&(i.observe(this._element,"touchstart",Ink.bindMethod(this,"_onTouchStart")),i.observe(this._element,"touchmove",Ink.bindMethod(this,"_onTouchMove")),i.observe(this._element,"touchend",Ink.bindMethod(this,"_onTouchEnd"))),this._setUpPagination(),this._setUpAutoAdvance(),this._options.onInit.call(this,this)},refit:function(){var t=this._isY,i=function(i,e){return i?e?n.outerDimensions(i)[t?0:1]:n.outerDimensions(i)[t?1:0]:0};this._liEls=Ink.ss("li.slide",this._ulEl);var e=this._liEls.length,s=this._ulEl.getBoundingClientRect();this._ctnLength=t?s.bottom-s.top:s.right-s.left,this._elLength=i(this._liEls[0]),this._slidesPerPage=Math.floor(this._ctnLength/this._elLength)||1,isFinite(this._slidesPerPage)||(this._slidesPerPage=1);var o=Math.ceil(e/this._slidesPerPage),h=this._numPages!==o;this._numPages=o,this._deltaLength=this._slidesPerPage*this._elLength,this._IE7(),this._pagination&&h&&this._pagination.setSize(this._numPages),this.setPage(a(this.getPage(),0,this._numPages-1))},_setUpPagination:function(){this._options.pagination?(t.isDOMElement(this._options.pagination)||"string"==typeof this._options.pagination?this._pagination=new s(this._options.pagination,{size:this._numPages,onChange:this._handlers.paginationChange}):(this._pagination=this._options.pagination,this._pagination.setOnChange(this._handlers.paginationChange),this._pagination.setSize(this._numPages)),this._pagination.setCurrent(this._options.initialPage||0)):this._currentPage=this._options.initialPage||0},_setUpAutoAdvance:function(){this._options.autoAdvance&&this.autoAdvance(this._options.autoAdvance)},autoAdvance:function(t){function i(){e.nextPage(!0),e._autoAdvanceSto=setTimeout(i,t)}if(!this._autoAdvanceSto){var e=this;this._autoAdvanceSto=setTimeout(i,t)}},stopAutoAdvance:function(){this._autoAdvanceSto&&(clearTimeout(this._autoAdvanceSto),this._autoAdvanceSto=null)},_IE7:function(){if(o.IE&&""+o.version.split(".")[0]=="7")for(var t=Ink.ss("li.slide",this._ulEl),i=function(i,n){t[e].style[i]=n},e=0,n=t.length;n>e;e++)i("position","absolute"),i(this._isY?"top":"left",e*this._elLength+"px")},_onTouchStart:function(t){if(!(t.touches.length>1)){this._swipeData={x:i.pointerX(t),y:i.pointerY(t)};var e=this._ulEl.getBoundingClientRect();this._swipeData.firstUlPos=e[this._isY?"top":"left"],this._swipeData.inUlX=this._swipeData.x-e.left,this._swipeData.inUlY=this._swipeData.y-e.top,_(this._ulEl,"none"),this._touchMoveIsFirstTouchMove=!0}},_onTouchMove:function(t){if(!(t.touches.length>1)){var e=i.pointerX(t),n=i.pointerY(t),s=this._swipeData.y-n,o=this._swipeData.x-e;if(this._touchMoveIsFirstTouchMove){var a=Math.abs(s),h=Math.abs(o);this._touchMoveIsFirstTouchMove=void 0,this._scrolling=this._isY?h>a:a>h,this._scrolling||this._onAnimationFrame()}!this._scrolling&&this._swipeData&&(i.stopDefault(t),this._swipeData.pointerDelta=this._isY?s:o,this._swipeData.pointerPos=this._isY?n:e)}},_onAnimationFrame:function(){var t=this._swipeData;if(t&&!this._scrolling&&!this._touchMoveIsFirstTouchMove){var i,e=this._element.getBoundingClientRect();i=this._isY?t.pointerPos-t.inUlY-e.top:t.pointerPos-t.inUlX-e.left,this._ulEl.style[this._isY?"top":"left"]=i+"px",l(Ink.bindMethod(this,"_onAnimationFrame"))}},_onTouchEnd:function(t){if(this._swipeData&&this._swipeData.pointerPos&&!this._scrolling&&!this._touchMoveIsFirstTouchMove){var e=.1,n=this._swipeData.pointerDelta,s=this.getPage(),o=n/this._elLength/this._slidesPerPage;Math.abs(o)>e&&(s+=Math[0>n?"floor":"ceil"](o)),s=a(s,0,this._numPages-1),isNaN(s)||this.setPage(s),i.stopDefault(t)}_(this._ulEl,null),this._swipeData=null,this._touchMoveIsFirstTouchMove=void 0,this._scrolling=void 0},_onPaginationChange:function(t){this._setPage(t.getCurrent())},getPage:function(){return this._pagination?this._pagination.getCurrent():this._currentPage||0},getPagination:function(){return this._pagination||null},setPage:function(t,i){return i&&(t%=this._numPages,0>t&&(t=this._numPages-t)),t=a(t,0,this._numPages-1),t===this._currentPage?void(this._swipeData&&this._setPage(t)):void(this._pagination?this._pagination.setCurrent(t):this._setPage(t))},_setPage:function(t){var i=t*this._deltaLength,e=t===this._numPages-1;if(!this._options.spaceAfterLastSlide&&e&&t>0){var n=this._liEls.length-t*this._slidesPerPage;n<this._slidesPerPage&&(i=(t-1)*this._deltaLength+n*this._elLength)}this._ulEl.style[this._isY?"top":"left"]=["-",i/this._ctnLength*100,"%"].join(""),this._options.onChange&&this._options.onChange.call(this,t),this._currentPage=t},nextPage:function(t){this.setPage(this.getPage()+1,t)},previousPage:function(t){this.setPage(this.getPage()-1,t)},getSlidesPerPage:function(){return this._slidesPerPage},getTotalPages:function(){return this._numPages},getStageElm:function(){return this._ulEl},getSlidesList:function(){return this._liEls},getTotalSlides:function(){return this.getSlidesList().length}},t.createUIComponent(h),h});