Ink.createModule("Ink.UI.Tooltip","1",["Ink.UI.Common_1","Ink.Dom.Event_1","Ink.Dom.Element_1","Ink.Dom.Selector_1","Ink.Util.Array_1","Ink.Dom.Css_1","Ink.Dom.Browser_1"],function(t,e,o,i,n,s){"use strict";function l(t,e){this._init(t,e||{})}function r(t,e){this._init(t,e)}var h,p,u;!function(){for(var t=document.createElement("DIV"),e=["transition","oTransition","msTransition","mozTransition","webkitTransition"],o=0;o<e.length;o++)if("undefined"!=typeof t.style[e[o]+"Duration"]){h=e[o]+"Duration",p=e[o]+"Property",u=e[o]+"TimingFunction";break}}();var m=document.getElementsByTagName("body"),a=m.length?m[0]:document.documentElement;return l.prototype={_init:function(t,e){var o;if(this.options=Ink.extendObj({where:"up",zIndex:1e4,left:10,top:10,spacing:8,forever:0,color:"",timeout:0,delay:0,template:null,templatefield:null,fade:.3,text:""},e||{}),"string"==typeof t)o=i.select(t);else{if("object"!=typeof t)throw"Element expected";o=[t]}this.tooltips=[];for(var n=0,s=o.length;s>n;n++)this.tooltips[n]=new r(this,o[n])},destroy:function(){n.each(this.tooltips,function(t){t._destroy()}),this.tooltips=null,this.options=null}},r.prototype={_oppositeDirections:{left:"right",right:"left",up:"down",down:"up"},_init:function(o,i){e.observe(i,"mouseover",Ink.bindEvent(this._onMouseOver,this)),e.observe(i,"focus",Ink.bindEvent(this._onMouseOver,this)),e.observe(i,"mouseout",Ink.bindEvent(this._onMouseOut,this)),e.observe(i,"blur",Ink.bindEvent(this._onMouseOut,this)),e.observe(i,"mousemove",Ink.bindEvent(this._onMouseMove,this)),this.root=o,this.element=i,this._delayTimeout=null,this.tooltip=null,t.registerInstance(this,this.element)},_makeTooltip:function(t){if(!this._getOpt("text")&&!this._getOpt("html")&&!o.hasAttribute(this.element,"title"))return!1;var i=this._createTooltipElement();this.tooltip&&this._removeTooltip(),this.tooltip=i,this._fadeInTooltipElement(i),this._placeTooltipElement(i,t),e.observe(i,"mouseover",Ink.bindEvent(this._onTooltipMouseOver,this));var n=this._getFloatOpt("timeout");n&&setTimeout(Ink.bind(function(){this.tooltip===i&&this._removeTooltip()},this),1e3*n)},_createTooltipElement:function(){var e,n,l=this._getOpt("template"),r=this._getOpt("templatefield");if(l){var h=document.createElement("DIV");if(h.innerHTML=t.elOrSelector(l,"options.template").outerHTML,e=h.firstChild,r){if(n=i.select(r,e),!n)throw"options.templatefield must be a valid selector within options.template";n=n[0]}else n=e}else e=document.createElement("DIV"),s.addClassName(e,"ink-tooltip"),s.addClassName(e,this._getOpt("color")),n=document.createElement("DIV"),s.addClassName(n,"content"),e.appendChild(n);return this._getOpt("html")?n.innerHTML=this._getOpt("html"):this._getOpt("text")?o.setTextContent(n,this._getOpt("text")):o.setTextContent(n,this.element.getAttribute("title")),e.style.display="block",e.style.position="absolute",e.style.zIndex=this._getIntOpt("zIndex"),e},_fadeInTooltipElement:function(t){var e=this._getFloatOpt("fade");h&&e&&(t.style.opacity="0",t.style[h]=e+"s",t.style[p]="opacity",t.style[u]="ease-in-out",setTimeout(function(){t.style.opacity="1"},0))},_placeTooltipElement:function(t,e){var i=this._getOpt("where");if(null!==e||"mousemove"!==i&&"mousefix"!==i||(i="up"),"mousemove"===i||"mousefix"===i){var n=e;this._setPos(n[0],n[1]),a.appendChild(t)}else if(i.match(/(up|down|left|right)/)){a.appendChild(t);var l=o.offset(this.element),r=l[0],h=l[1],p=o.elementWidth(this.element)/2-o.elementWidth(t)/2,u=o.elementHeight(this.element)/2-o.elementHeight(t)/2,m=this._getIntOpt("spacing"),d=o.elementDimensions(t),c=o.elementDimensions(this.element),f=o.scrollWidth()+o.viewportWidth(),_=o.scrollHeight()+o.viewportHeight();i=this._getWhereValueInsideViewport(i,{left:r-d[0],right:r+d[0],top:h+d[1],bottom:h+d[1]},{right:f,bottom:_}),"up"===i?(h-=d[1],h-=m,r+=p):"down"===i?(h+=c[1],h+=m,r+=p):"left"===i?(r-=d[0],r-=m,h+=u):"right"===i&&(r+=c[0],r+=m,h+=u);var g=null;i.match(/(up|down|left|right)/)&&(g=document.createElement("SPAN"),s.addClassName(g,"arrow"),s.addClassName(g,this._oppositeDirections[i]),t.appendChild(g));var v=r,y=h,I=y+d[1]-_,T=v+d[0]-f,O=0-v,b=0-y;I>0?(g&&(g.style.top=d[1]/2+I+"px"),y-=I):b>0?(g&&(g.style.top=d[1]/2-b+"px"),y+=b):T>0?(g&&(g.style.left=d[0]/2+T+"px"),v-=T):O>0&&(g&&(g.style.left=d[0]/2-O+"px"),v+=O),t.style.left=v+"px",t.style.top=y+"px"}},_getWhereValueInsideViewport:function(t,e,o){return"left"===t&&e.left<0?"right":"right"===t&&e.right>o.right?"left":"up"===t&&e.top<0?"down":"down"===t&&e.bottom>o.bottom?"up":t},_removeTooltip:function(){var t=this.tooltip;if(t){var e=Ink.bind(o.remove,{},t);"mousemove"!==this._getOpt("where")&&h?(t.style.opacity=0,setTimeout(e,1e3*this._getFloatOpt("fade"))):e(),this.tooltip=null}},_getOpt:function(t){var e=o.data(this.element)[o._camelCase("tip-"+t)];if(e)return e;var i=this.root.options[t];return"undefined"!=typeof i?i:void 0},_getIntOpt:function(t){return parseInt(this._getOpt(t),10)},_getFloatOpt:function(t){return parseFloat(this._getOpt(t),10)},_destroy:function(){this.tooltip&&o.remove(this.tooltip),this.root=null,this.element=null,this.tooltip=null},_onMouseOver:function(t){var e;e="mouseover"!==t.type?null:this._getMousePosition(t);var o=this._getFloatOpt("delay");o?this._delayTimeout=setTimeout(Ink.bind(function(){this.tooltip||this._makeTooltip(e),this._delayTimeout=null},this),1e3*o):this._makeTooltip(e)},_onMouseMove:function(t){if("mousemove"===this._getOpt("where")&&this.tooltip){var e=this._getMousePosition(t);this._setPos(e[0],e[1])}},_onMouseOut:function(){this._getIntOpt("forever")||this._removeTooltip(),this._delayTimeout&&(clearTimeout(this._delayTimeout),this._delayTimeout=null)},_onTooltipMouseOver:function(){this.tooltip&&this._removeTooltip()},_setPos:function(t,e){t+=this._getIntOpt("left"),e+=this._getIntOpt("top");var i=this._getPageXY();if(this.tooltip){var n=[o.elementWidth(this.tooltip),o.elementHeight(this.tooltip)],s=this._getScroll();n[0]+t-s[0]>=i[0]-20&&(t=t-n[0]-this._getIntOpt("left")-10),n[1]+e-s[1]>=i[1]-20&&(e=e-n[1]-this._getIntOpt("top")-10),this.tooltip.style.left=t+"px",this.tooltip.style.top=e+"px"}},_getPageXY:function(){var t=0,e=0;return"number"==typeof window.innerWidth?(t=window.innerWidth,e=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(t=document.body.clientWidth,e=document.body.clientHeight),[parseInt(t,10),parseInt(e,10)]},_getScroll:function(){var t=document.documentElement,e=document.body;return t&&(t.scrollLeft||t.scrollTop)?[t.scrollLeft,t.scrollTop]:e?[e.scrollLeft,e.scrollTop]:[0,0]},_getMousePosition:function(t){return[parseInt(e.pointerX(t),10),parseInt(e.pointerY(t),10)]}},l});